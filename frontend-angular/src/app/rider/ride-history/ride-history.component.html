<div class="container">
    <mat-card>
        <mat-card-header>
            <mat-card-title>Ride History</mat-card-title>
        </mat-card-header>
        <mat-card-content>
            <div *ngIf="loading">Loading history...</div>
            <div *ngIf="!loading && rides.length === 0">
                <p>No rides found.</p>
            </div>

            <mat-accordion *ngIf="rides.length > 0">
                <mat-expansion-panel *ngFor="let ride of rides" (opened)="selectRide(ride)" (closed)="selectRide(null)">
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            {{ getAreaName(ride.stationAreaId) }} to {{ getAreaName(ride.destinationAreaId) }}
                        </mat-panel-title>
                        <mat-panel-description>
                            {{ getStatusLabel(ride.status) }}
                        </mat-panel-description>
                    </mat-expansion-panel-header>

                    <div class="ride-details">
                        <p><strong>Requested Arrival:</strong> {{ ride.arrivalTime |
                            date:'medium' }}</p>

                        <div *ngIf="tripDetails.get(ride.intentId) as trip">
                            <mat-divider></mat-divider>
                            <h3>Trip Details</h3>
                            <p><strong>Trip ID:</strong> {{ trip.tripId }}</p>
                            <p><strong>Scheduled Departure:</strong> {{ trip.scheduledDeparture |
                                date:'medium' }}</p>
                            <p><strong>Status:</strong> {{ trip.status }}</p>

                            <div *ngIf="driverDetails.get(ride.intentId) as driver">
                                <mat-divider></mat-divider>
                                <h4>Driver</h4>
                                <p><strong>Name:</strong> {{ driverNames.get(ride.intentId) || 'Loading...' }}</p>
                                <p><strong>Vehicle:</strong> {{ driver.color }} {{ driver.model }}</p>
                                <p><strong>Plate:</strong> {{ driver.vehicleNo }}</p>
                                <p><strong>Capacity:</strong> {{ driver.capacity }} seats</p>
                            </div>
                        </div>
                    </div>
                </mat-expansion-panel>
            </mat-accordion>
        </mat-card-content>
    </mat-card>
</div>